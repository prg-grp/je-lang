package de.tuda.stg.battleship;

@Enclave
public class GridPlayer2 {

    @Secret
    final static boolean[] myGrid = new boolean[]{false, false, true, false, true, false, true, false, true, true};

    @Gateway
    public static int applyOppsGuess(final int location) {   //Termination sensitivity ? Add exception ? or try-catch ?
        int result = 0;
        int locationE = endorse(location);
        if (locationE >= 0) {
            if (!myGrid[locationE]) {
                result = -1;    // Battleship absent  // Implicit flow result is now secret
            }
            else {
                result = 1;    // Battleship present / Battleship hit by the opponent
                myGrid[locationE] = false; // Battleship hit by the opponent
            }
            if (allFalse()) {
                result = 2;  // All battleships hit
            }
        }
        return  declassify(result);
    }

    private static boolean allFalse() {   //Termination sensitivity ? Add exception ? or try-catch ?
        boolean allFalse = true;
        for (int i = 0; i < myGrid.length; i++) {
            if (myGrid[i]) {
                allFalse = false;
                break;
            }
        }
        return allFalse;
    }
}
